<div class="max-w-4xl mx-auto flex flex-col gap-8 pb-20 animate-fade-in">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
        <div>
            <div class="flex items-center gap-2 text-sm text-slate-500 mb-2">
                <a routerLink="/admin/dashboard" class="hover:text-primary transition-colors">Dashboard</a>
                <span class="material-symbols-outlined text-[14px]">chevron_right</span>
                <a routerLink="/admin/games" class="hover:text-primary transition-colors">Games</a>
                <span class="material-symbols-outlined text-[14px]">chevron_right</span>
                <span class="text-white">{{ isEditMode ? 'Edit Game' : 'New Game' }}</span>
            </div>
            <h1 class="text-3xl font-bold text-white tracking-tight">{{ isEditMode ? 'Edit Game' : 'Add New Game' }}
            </h1>
        </div>
        <div class="flex gap-3">
            <button routerLink="/admin/games"
                class="px-4 py-2.5 rounded-lg bg-[#2b3548] text-white text-sm font-bold hover:bg-[#343e52] transition-colors border border-slate-700">
                Cancel
            </button>
            <button (click)="saveGame()"
                class="px-6 py-2.5 rounded-lg bg-primary hover:bg-primary-dark text-white text-sm font-bold shadow-lg shadow-primary/25 transition-all flex items-center gap-2">
                <span class="material-symbols-outlined text-[20px]">save</span>
                <span>{{ isEditMode ? 'Update Game' : 'Publish Game' }}</span>
            </button>
        </div>
    </div>

    <!-- Tabs -->
    <div class="border-b border-slate-700 flex gap-6">
        <button (click)="activeTab = 'info'" class="pb-3 text-sm font-bold transition-colors border-b-2"
            [class.border-primary]="activeTab === 'info'" [class.text-primary]="activeTab === 'info'"
            [class.border-transparent]="activeTab !== 'info'" [class.text-slate-400]="activeTab !== 'info'">
            General Info
        </button>
        <button (click)="activeTab = 'media'" class="pb-3 text-sm font-bold transition-colors border-b-2"
            [class.border-primary]="activeTab === 'media'" [class.text-primary]="activeTab === 'media'"
            [class.border-transparent]="activeTab !== 'media'" [class.text-slate-400]="activeTab !== 'media'">
            Media & Gallery
        </button>
        <button (click)="activeTab = 'versions'" class="pb-3 text-sm font-bold transition-colors border-b-2"
            [class.border-primary]="activeTab === 'versions'" [class.text-primary]="activeTab === 'versions'"
            [class.border-transparent]="activeTab !== 'versions'" [class.text-slate-400]="activeTab !== 'versions'">
            Versions & Downloads
        </button>
    </div>

    <!-- TAB: INFO -->
    <div *ngIf="activeTab === 'info'" class="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
        <!-- Left Column: Media -->
        <div class="space-y-6">
            <div class="bg-[#1a1f2e] border border-slate-800 rounded-xl p-5">
                <h3 class="text-white font-bold mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">image</span> Cover Image
                </h3>
                <div
                    class="relative aspect-[3/4] rounded-lg bg-slate-900 border-2 border-dashed border-slate-700 hover:border-primary transition-colors cursor-pointer overflow-hidden group">
                    <div *ngIf="gameRequest.coverImage" class="absolute inset-0 bg-cover bg-center"
                        [style.background-image]="'url(' + gameRequest.coverImage + ')'"></div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center text-slate-500 group-hover:text-white transition-colors z-10"
                        [class.bg-black/50]="gameRequest.coverImage">
                        <span class="material-symbols-outlined text-4xl mb-2">cloud_upload</span>
                        <span class="text-xs font-bold uppercase tracking-wider">Upload Cover</span>
                    </div>
                </div>
                <div class="mt-4">
                    <label class="text-xs font-bold text-slate-500 uppercase">Image URL</label>
                    <input type="text" [(ngModel)]="gameRequest.coverImage" placeholder="https://..."
                        class="w-full mt-1 bg-[#111318] border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:ring-1 focus:ring-primary focus:border-primary placeholder:text-slate-600">
                </div>
            </div>

            <div class="bg-[#1a1f2e] border border-slate-800 rounded-xl p-5">
                <h3 class="text-white font-bold mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">category</span> Categorization
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Status</label>
                        <select [(ngModel)]="gameRequest.status"
                            class="w-full bg-[#111318] border border-slate-700 rounded-lg px-3 py-2.5 text-sm text-white focus:ring-1 focus:ring-primary focus:border-primary">
                            <option value="Active">Active</option>
                            <option value="Early Access">Early Access</option>
                            <option value="Upcoming">Upcoming</option>
                            <option value="Archived">Archived</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Primary Genre</label>
                        <select [(ngModel)]="gameRequest.genre"
                            class="w-full bg-[#111318] border border-slate-700 rounded-lg px-3 py-2.5 text-sm text-white focus:ring-1 focus:ring-primary focus:border-primary">
                            <option>Action RPG</option>
                            <option>FPS</option>
                            <option>Strategy</option>
                            <option>Adventure</option>
                            <option>Simulation</option>
                            <option>Sports</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Details -->
        <div class="lg:col-span-2 space-y-6">
            <div class="bg-[#1a1f2e] border border-slate-800 rounded-xl p-6 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-bold text-slate-300 mb-1">Game Title</label>
                        <input type="text" [(ngModel)]="gameRequest.title" placeholder="e.g. Cyberpunk 2077"
                            class="w-full bg-[#111318] border border-slate-700 rounded-lg px-4 py-3 text-white focus:ring-1 focus:ring-primary focus:border-primary placeholder:text-slate-600">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-300 mb-1">Developer</label>
                        <input type="text" [(ngModel)]="gameRequest.developer" placeholder="e.g. CD Projekt Red"
                            class="w-full bg-[#111318] border border-slate-700 rounded-lg px-4 py-3 text-white focus:ring-1 focus:ring-primary focus:border-primary placeholder:text-slate-600">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-slate-300 mb-1">Description</label>
                    <textarea [(ngModel)]="gameRequest.description" rows="6"
                        placeholder="Enter full game description..."
                        class="w-full bg-[#111318] border border-slate-700 rounded-lg px-4 py-3 text-white focus:ring-1 focus:ring-primary focus:border-primary placeholder:text-slate-600 resize-none custom-scrollbar"></textarea>
                    <p class="text-right text-xs text-slate-500 mt-1">Markdown supported</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-bold text-slate-300 mb-1">Release Date</label>
                        <input type="date" [ngModel]="gameRequest.releaseDate | date:'yyyy-MM-dd'"
                            (ngModelChange)="gameRequest.releaseDate = $event"
                            class="w-full bg-[#111318] border border-slate-700 rounded-lg px-4 py-3 text-white focus:ring-1 focus:ring-primary focus:border-primary placeholder:text-slate-600">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-300 mb-1">Initial Rating</label>
                        <div class="flex items-center gap-4 bg-[#111318] border border-slate-700 rounded-lg px-4 py-3">
                            <span class="text-xl font-bold text-white">{{ gameRequest.rating || 0 }}</span>
                            <div class="flex flex-1 gap-1">
                                <span *ngFor="let star of [1,2,3,4,5]" (click)="gameRequest.rating = star"
                                    class="material-symbols-outlined cursor-pointer hover:text-amber-400 transition-colors select-none"
                                    [class.filled-icon]="star <= (gameRequest.rating || 0)"
                                    [class.text-amber-400]="star <= (gameRequest.rating || 0)"
                                    [class.text-slate-600]="star > (gameRequest.rating || 0)">star</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-[#1a1f2e] border border-slate-800 rounded-xl p-6">
                <h3 class="text-white font-bold mb-4 border-b border-slate-700 pb-2">System Requirements (Minimum)</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">OS</label>
                        <input type="text" [(ngModel)]="gameRequest.minimumRequirements!.os"
                            class="w-full mt-1 bg-[#111318] border border-slate-700 rounded px-3 py-2 text-sm text-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Processor</label>
                        <input type="text" [(ngModel)]="gameRequest.minimumRequirements!.processor"
                            class="w-full mt-1 bg-[#111318] border border-slate-700 rounded px-3 py-2 text-sm text-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Memory</label>
                        <input type="text" [(ngModel)]="gameRequest.minimumRequirements!.memory"
                            class="w-full mt-1 bg-[#111318] border border-slate-700 rounded px-3 py-2 text-sm text-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Graphics</label>
                        <input type="text" [(ngModel)]="gameRequest.minimumRequirements!.graphics"
                            class="w-full mt-1 bg-[#111318] border border-slate-700 rounded px-3 py-2 text-sm text-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Storage</label>
                        <input type="text" [(ngModel)]="gameRequest.minimumRequirements!.storage"
                            class="w-full mt-1 bg-[#111318] border border-slate-700 rounded px-3 py-2 text-sm text-white">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: MEDIA -->
    <div *ngIf="activeTab === 'media'" class="space-y-6 animate-fade-in">
        <div class="flex items-center justify-between">
            <h3 class="text-xl font-bold text-white">Screenshots Gallery</h3>
            <button (click)="addScreenshot()"
                class="px-4 py-2 rounded-lg bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500/20 text-sm font-bold transition-colors">
                + Add Screenshot
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div *ngFor="let media of gameRequest.screenshots; let i = index"
                class="bg-[#1a1f2e] border border-slate-800 rounded-xl p-4 group relative">
                <button (click)="removeScreenshot(i)"
                    class="absolute top-2 right-2 bg-red-500 text-white p-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity z-10">
                    <span class="material-symbols-outlined text-[16px]">close</span>
                </button>

                <div class="aspect-video bg-black rounded-lg mb-3 overflow-hidden">
                    <img *ngIf="media.url" [src]="media.url" class="w-full h-full object-cover">
                    <div *ngIf="!media.url" class="w-full h-full flex items-center justify-center text-slate-700">
                        <span class="material-symbols-outlined text-4xl">image</span>
                    </div>
                </div>
                <input type="text" [(ngModel)]="media.url" placeholder="Image URL..."
                    class="w-full bg-[#111318] border border-slate-700 rounded px-3 py-2 text-sm text-white focus:ring-1 focus:ring-primary focus:border-primary">
            </div>
        </div>

        <div *ngIf="!gameRequest.screenshots?.length"
            class="text-center py-12 border-2 border-dashed border-slate-800 rounded-2xl text-slate-500">
            No screenshots added yet.
        </div>
    </div>

    <!-- TAB: VERSIONS -->
    <div *ngIf="activeTab === 'versions'" class="space-y-8 animate-fade-in">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-xl font-bold text-white">Game Versions</h3>
                <p class="text-slate-400 text-sm">Manage different editions (Global, Region-specific, Repacks).</p>
            </div>
            <button (click)="addVersion()"
                class="px-4 py-2 rounded-lg bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500/20 text-sm font-bold transition-colors">
                + Add Version
            </button>
        </div>

        <div *ngFor="let version of gameRequest.versions; let vIndex = index"
            class="bg-[#1a1f2e] border border-slate-800 rounded-xl overflow-hidden">
            <!-- Version Header -->
            <div class="bg-[#232936] px-6 py-4 flex items-center justify-between border-b border-slate-800">
                <div class="flex gap-4 flex-1">
                    <input type="text" [(ngModel)]="version.name" placeholder="Version Name (e.g. Global)"
                        class="bg-transparent text-white font-bold border-b border-slate-600 focus:border-primary outline-none px-1">
                    <input type="text" [(ngModel)]="version.language" placeholder="Language"
                        class="bg-transparent text-slate-400 text-sm border-b border-slate-600 focus:border-primary outline-none px-1 w-32">
                </div>
                <button (click)="removeVersion(vIndex)" class="text-red-500 hover:text-red-400">
                    <span class="material-symbols-outlined">delete</span>
                </button>
            </div>

            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-sm font-bold text-slate-400 uppercase tracking-wider">Updates & Patches</h4>
                    <button (click)="addUpdate(vIndex)" class="text-xs font-bold text-primary hover:text-primary-light">
                        + Add Update
                    </button>
                </div>

                <div class="space-y-4">
                    <div *ngFor="let update of version.updates; let uIndex = index"
                        class="bg-[#111318] border border-slate-700 rounded-lg p-4">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div class="md:col-span-2">
                                <label class="text-[10px] font-bold text-slate-500 uppercase">Update Name</label>
                                <input type="text" [(ngModel)]="update.name" placeholder="v1.0.0"
                                    class="w-full mt-1 bg-[#0a0c10] border border-slate-700 rounded px-2 py-1.5 text-sm text-white">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-500 uppercase">Size</label>
                                <input type="text" [(ngModel)]="update.size" placeholder="60 GB"
                                    class="w-full mt-1 bg-[#0a0c10] border border-slate-700 rounded px-2 py-1.5 text-sm text-white">
                            </div>
                            <div class="flex items-end justify-between">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" [(ngModel)]="update.isLatest"
                                        class="w-4 h-4 rounded bg-[#0a0c10] border-slate-700 text-primary focus:ring-offset-0 focus:ring-0">
                                    <span class="text-sm text-white">Latest?</span>
                                </label>
                                <button (click)="removeUpdate(vIndex, uIndex)"
                                    class="text-red-500 text-xs hover:underline">Remove</button>
                            </div>
                        </div>

                        <!-- Links -->
                        <div class="bg-[#0a0c10] rounded border border-slate-800 p-3">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="text-[10px] font-bold text-slate-500 uppercase">Download Links</h5>
                                <button (click)="addLink(vIndex, uIndex)"
                                    class="text-[10px] font-bold text-blue-400 hover:text-blue-300">
                                    + Add Link
                                </button>
                            </div>
                            <div class="space-y-2">
                                <div *ngFor="let link of update.cdnLinks; let lIndex = index"
                                    class="flex gap-2 items-center">
                                    <select [(ngModel)]="link.provider"
                                        class="bg-[#1a1f2e] border border-slate-700 rounded text-xs text-white h-8 px-2">
                                        <option value="mediafire">Mediafire</option>
                                        <option value="gdrive">GDrive</option>
                                        <option value="mega">Mega</option>
                                        <option value="torrent">Torrent</option>
                                        <option value="direct">Direct</option>
                                    </select>
                                    <input type="text" [(ngModel)]="link.url" placeholder="URL..."
                                        class="flex-1 bg-[#1a1f2e] border border-slate-700 rounded text-xs text-white h-8 px-2">
                                    <button (click)="removeLink(vIndex, uIndex, lIndex)"
                                        class="text-red-500 hover:text-red-400 px-1">
                                        <span class="material-symbols-outlined text-[16px]">close</span>
                                    </button>
                                </div>
                                <div *ngIf="!update.cdnLinks?.length" class="text-xs text-slate-600 italic">No links.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="!version.updates?.length"
                        class="text-center py-4 text-sm text-slate-500 border border-dashed border-slate-700 rounded-lg">
                        No updates in this version.
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="!gameRequest.versions?.length"
            class="text-center py-12 border-2 border-dashed border-slate-800 rounded-2xl text-slate-500">
            No versions defined. Add a 'Global' version to start.
        </div>
    </div>
</div>