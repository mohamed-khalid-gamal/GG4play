<div class="min-h-screen flex flex-col bg-background-dark font-display">
    <!-- Header -->
    <header
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#282e39] bg-[#111318] px-4 py-3 md:px-10">
        <a routerLink="/" class="flex items-center gap-4 text-white">
            <div class="size-8 text-primary">
                <span class="material-symbols-outlined" style="font-size: 32px;">sports_esports</span>
            </div>
            <h2 class="text-white text-xl font-bold leading-tight tracking-[-0.015em]">gg4play</h2>
        </a>
        <button (click)="goBackToGame()"
            class="flex items-center gap-2 text-slate-400 hover:text-white text-sm font-medium transition-colors">
            <span class="material-symbols-outlined text-[18px]">arrow_back</span>
            Back to Game
        </button>
    </header>

    <!-- Main Content Layout -->
    <main class="flex-1 w-full max-w-[1200px] mx-auto px-4 md:px-8 py-8 flex flex-col gap-8">
        @if (isLoading()) {
        <div class="flex items-center justify-center h-64">
            <div class="animate-spin">
                <span class="material-symbols-outlined text-primary text-4xl">progress_activity</span>
            </div>
        </div>
        } @else if (hasValidSession()) {
        <!-- Top Leaderboard Ad Placeholder -->
        <div class="w-full flex justify-center">
            <app-ad-placeholder size="leaderboard" label="Advertisement Space"></app-ad-placeholder>
        </div>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Main Column (Download Flow) -->
            <div class="lg:col-span-8 flex flex-col gap-6">
                <!-- Progress Bar Step 2 -->
                <div class="flex flex-col gap-3 p-4 rounded-xl bg-[#1b1f27] border border-[#282e39] shadow-sm">
                    <div class="flex gap-6 justify-between items-center">
                        <div class="flex items-center gap-2">
                            <span
                                class="flex items-center justify-center size-6 rounded-full bg-primary text-white text-xs font-bold">2</span>
                            <p class="text-white text-base font-medium leading-normal">Verification</p>
                        </div>
                        <p class="text-[#9ca6ba] text-sm font-normal leading-normal">Step 2 of 3</p>
                    </div>
                    <div class="rounded-full bg-[#282e39] h-2 overflow-hidden">
                        <div class="h-full rounded-full bg-primary shadow-[0_0_10px_rgba(13,89,242,0.5)]"
                            style="width: 66%;"></div>
                    </div>
                </div>

                <!-- Page Heading & Status -->
                <div class="flex flex-col gap-2 px-1">
                    <h1 class="text-white text-3xl md:text-4xl font-bold leading-tight tracking-tight">Your download is
                        almost ready</h1>
                    <p class="text-[#9ca6ba] text-base font-normal">Please verify the file details below. Our secure
                        servers are preparing your unique download link.</p>
                </div>

                <!-- Main Action Card -->
                @if (game && fileInfo) {
                <div class="relative group">
                    <!-- Glow effect behind card -->
                    <div
                        class="absolute -inset-0.5 bg-gradient-to-r from-primary to-[#6366f1] rounded-xl opacity-20 blur group-hover:opacity-40 transition duration-500">
                    </div>
                    <div
                        class="relative flex flex-col md:flex-row items-stretch justify-between gap-6 rounded-xl bg-[#1a1a20] p-6 shadow-xl border border-[#282e39]">
                        <!-- File Info -->
                        <div class="flex flex-[2_2_0px] flex-col justify-between gap-6">
                            <div class="flex gap-4">
                                <div
                                    class="size-16 rounded-lg bg-[#282e39] flex items-center justify-center shrink-0 text-primary">
                                    <span class="material-symbols-outlined" style="font-size: 32px;">folder_zip</span>
                                </div>
                                <div class="flex flex-col gap-1">
                                    <h3 class="text-white text-xl font-bold leading-tight">{{ fileInfo.name }}.exe</h3>
                                    <div class="flex flex-wrap gap-3 items-center text-sm text-[#9ca6ba]">
                                        <span class="flex items-center gap-1">
                                            <span class="material-symbols-outlined text-xs">info</span> {{
                                            fileInfo.version }}
                                        </span>
                                        <span class="size-1 rounded-full bg-[#3b4354]"></span>
                                        <span class="flex items-center gap-1">
                                            <span class="material-symbols-outlined text-xs">hard_drive</span> {{
                                            fileInfo.size }}
                                        </span>
                                        <span class="size-1 rounded-full bg-[#3b4354]"></span>
                                        <span class="flex items-center gap-1 text-emerald-400">
                                            <span class="material-symbols-outlined text-xs">verified_user</span> Virus
                                            Scanned
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Timer / Status Area -->
                            <div class="flex flex-col gap-3">
                                <div class="flex items-center gap-2 text-primary">
                                    <span class="material-symbols-outlined animate-pulse"
                                        style="font-size: 20px;">check_circle</span>
                                    <span class="text-sm font-medium">Link generated successfully</span>
                                </div>
                                <button (click)="continueToDownload()"
                                    class="flex w-full md:w-fit cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-8 bg-primary hover:bg-blue-600 active:scale-95 transition-all text-white text-base font-bold shadow-[0_4px_14px_0_rgba(13,89,242,0.39)]">
                                    <span>Continue to Download</span>
                                    <span class="material-symbols-outlined">arrow_forward</span>
                                </button>
                                <p class="text-xs text-[#58627a]">By clicking continue, you agree to our Terms of
                                    Service.</p>
                            </div>
                        </div>

                        <!-- Game Art -->
                        <div class="w-full md:w-1/3 bg-center bg-no-repeat bg-cover rounded-lg min-h-[160px] md:min-h-full relative overflow-hidden"
                            [style.background-image]="'url(' + game.coverImage + ')'">
                            <div class="absolute inset-0 bg-gradient-to-t from-[#1a1a20] to-transparent opacity-80">
                            </div>
                            <div class="absolute bottom-3 left-3">
                                <span
                                    class="px-2 py-1 rounded bg-black/50 backdrop-blur-sm text-[10px] text-white font-bold uppercase border border-white/10">
                                    Official Installer
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                }

                <!-- Trust Signals -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-2">
                    <div class="flex items-center gap-2 p-3 rounded-lg bg-[#1b1f27]/50 border border-[#282e39]/50">
                        <span class="material-symbols-outlined text-[#9ca6ba]">speed</span>
                        <div class="flex flex-col">
                            <span class="text-white text-xs font-bold">Fast DL</span>
                            <span class="text-[#58627a] text-[10px]">Optimized servers</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 p-3 rounded-lg bg-[#1b1f27]/50 border border-[#282e39]/50">
                        <span class="material-symbols-outlined text-[#9ca6ba]">shield</span>
                        <div class="flex flex-col">
                            <span class="text-white text-xs font-bold">Secure</span>
                            <span class="text-[#58627a] text-[10px]">End-to-end enc.</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 p-3 rounded-lg bg-[#1b1f27]/50 border border-[#282e39]/50">
                        <span class="material-symbols-outlined text-[#9ca6ba]">history</span>
                        <div class="flex flex-col">
                            <span class="text-white text-xs font-bold">Resume</span>
                            <span class="text-[#58627a] text-[10px]">Supported</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 p-3 rounded-lg bg-[#1b1f27]/50 border border-[#282e39]/50">
                        <span class="material-symbols-outlined text-[#9ca6ba]">support</span>
                        <div class="flex flex-col">
                            <span class="text-white text-xs font-bold">24/7</span>
                            <span class="text-[#58627a] text-[10px]">Support team</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Side Column (Ad & Secondary) -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <app-ad-placeholder size="rect" label="Ad (300x250)"></app-ad-placeholder>

                <!-- Top Games Card -->
                <div
                    class="w-full max-w-[300px] rounded-lg bg-[#111318] border border-[#282e39] p-4 flex flex-col gap-4">
                    <div class="flex items-center justify-between">
                        <h4 class="text-white font-bold text-sm">Top Games This Week</h4>
                        <a class="text-xs text-primary hover:underline" routerLink="/">View All</a>
                    </div>
                    <div class="flex flex-col gap-3">
                        <div class="flex items-center gap-3">
                            <div class="size-10 rounded bg-gradient-to-br from-red-500 to-orange-500"></div>
                            <div class="flex flex-col">
                                <span class="text-white text-sm font-medium">Nebula Raiders</span>
                                <span class="text-[#58627a] text-xs">RPG • 4.8★</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="size-10 rounded bg-gradient-to-br from-blue-500 to-cyan-500"></div>
                            <div class="flex flex-col">
                                <span class="text-white text-sm font-medium">Circuit Breaker</span>
                                <span class="text-[#58627a] text-xs">Puzzle • 4.5★</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="size-10 rounded bg-gradient-to-br from-green-500 to-emerald-500"></div>
                            <div class="flex flex-col">
                                <span class="text-white text-sm font-medium">Void Walker</span>
                                <span class="text-[#58627a] text-xs">Action • 4.9★</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        }
    </main>

    <!-- Footer -->
    <footer class="mt-auto border-t border-[#282e39] bg-[#111318] py-6">
        <div class="mx-auto flex max-w-[960px] flex-col gap-6 px-4 md:flex-row md:items-center md:justify-between">
            <div class="flex items-center gap-2 text-white">
                <span class="material-symbols-outlined text-primary">sports_esports</span>
                <span class="font-bold">gg4play</span>
            </div>
            <div class="flex flex-wrap gap-6 text-sm font-medium text-[#9ca6ba]">
                <a class="hover:text-white transition-colors" href="#">Privacy Policy</a>
                <a class="hover:text-white transition-colors" href="#">Terms of Service</a>
                <a class="hover:text-white transition-colors" href="#">DMCA</a>
            </div>
        </div>
    </footer>
</div>