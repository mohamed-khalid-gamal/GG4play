<div class="min-h-screen flex flex-col bg-background-dark">
    <!-- Header -->
    <header
        class="sticky top-0 z-50 flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#282e39] bg-[#111318]/95 backdrop-blur-md px-6 md:px-10 py-3">
        <a routerLink="/" class="flex items-center gap-4 text-white cursor-pointer">
            <div class="size-8 flex items-center justify-center bg-primary/20 rounded-lg text-primary">
                <span class="material-symbols-outlined" style="font-size: 24px;">downloading</span>
            </div>
            <h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em]">gg4play</h2>
        </a>
        <button (click)="goBackToGame()"
            class="flex items-center gap-2 text-slate-400 hover:text-white text-sm font-medium transition-colors">
            <span class="material-symbols-outlined text-[18px]">arrow_back</span>
            Back to Game
        </button>
    </header>

    <!-- Main Content -->
    <main class="flex-1 w-full max-w-[1280px] mx-auto px-4 py-8 lg:px-8">
        @if (isLoading()) {
        <div class="flex items-center justify-center h-64">
            <div class="animate-spin">
                <span class="material-symbols-outlined text-primary text-4xl">progress_activity</span>
            </div>
        </div>
        } @else if (hasValidSession()) {
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left Column: Download Process -->
            <div class="lg:col-span-8 flex flex-col gap-6">
                <!-- Page Heading & Status -->
                <div class="flex flex-col gap-2">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined text-primary animate-spin"
                            style="font-size: 32px;">hourglass_empty</span>
                        <h1 class="text-white text-3xl lg:text-4xl font-black leading-tight tracking-[-0.033em]">
                            Preparing your download...
                        </h1>
                    </div>
                    <p class="text-[#9ca6ba] text-base font-normal leading-normal pl-1">
                        Please wait a moment while we scan and prepare your file securely.
                    </p>
                </div>

                <!-- Timer & Action Module -->
                <div
                    class="bg-[#1b1f27] border border-[#282e39] rounded-xl p-8 flex flex-col items-center justify-center gap-8 shadow-[0_0_50px_rgba(0,0,0,0.2)] relative overflow-hidden">
                    <!-- Subtle background glow -->
                    <div
                        class="absolute top-0 left-1/2 -translate-x-1/2 w-1/2 h-1/2 bg-primary/5 blur-[100px] rounded-full pointer-events-none">
                    </div>

                    <!-- Countdown Timer Component -->
                    <app-countdown-timer [seconds]="timerSeconds" [autoStart]="true" [showProgress]="true"
                        statusText="Scanning for malware..." (onComplete)="onCountdownComplete()">
                    </app-countdown-timer>

                    <!-- Primary Action (Disabled State) -->
                    <button
                        class="w-full max-w-md mt-4 flex items-center justify-center gap-3 rounded-lg h-14 bg-[#282e39] text-[#9ca6ba] text-base font-bold cursor-not-allowed border border-[#3b4354] opacity-75 z-10"
                        disabled>
                        <span class="material-symbols-outlined">lock_clock</span>
                        <span>Download will start automatically</span>
                    </button>

                    <p class="text-xs text-[#5f6a80] mt-2">
                        By downloading, you agree to our Terms of Service and Privacy Policy.
                    </p>
                </div>

                <!-- File Summary Card -->
                @if (game && update) {
                <div
                    class="flex items-stretch justify-between gap-6 rounded-xl bg-[#1b1f27] p-6 border border-[#282e39] shadow-lg">
                    <div class="hidden sm:block w-28 h-28 shrink-0 rounded-lg bg-cover bg-center shadow-inner"
                        [style.background-image]="'url(' + game.coverImage + ')'">
                    </div>
                    <div class="flex flex-1 flex-col justify-center gap-3">
                        <div class="flex flex-col">
                            <div class="flex items-center gap-2 mb-1">
                                <span
                                    class="px-2 py-0.5 rounded bg-primary/20 text-primary text-[10px] font-bold uppercase tracking-wider border border-primary/20">
                                    {{ version?.name || 'Standard' }}
                                </span>
                                <span
                                    class="px-2 py-0.5 rounded bg-[#282e39] text-[#9ca6ba] text-[10px] font-bold uppercase tracking-wider">
                                    Verified
                                </span>
                            </div>
                            <h3 class="text-white text-xl font-bold leading-tight">{{ game.title }} - {{ update.name }}
                            </h3>
                            <div class="flex flex-wrap gap-x-4 gap-y-1 mt-1 text-sm text-[#9ca6ba]">
                                <span class="flex items-center gap-1">
                                    <span class="material-symbols-outlined text-xs">sd_storage</span> {{ update.size }}
                                </span>
                                <span class="flex items-center gap-1">
                                    <span class="material-symbols-outlined text-xs">info</span> {{ update.name }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col justify-center border-l border-[#282e39] pl-6 ml-2">
                        <a [routerLink]="['/game', game.id]"
                            class="flex items-center gap-2 text-primary hover:text-white transition-colors text-sm font-medium">
                            <span>View Details</span>
                            <span class="material-symbols-outlined" style="font-size: 16px;">arrow_forward</span>
                        </a>
                    </div>
                </div>
                }
            </div>

            <!-- Right Column: Ads & Recommendations -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <app-ad-placeholder size="rect" label="Level Up Your Gear" [sponsored]="true"></app-ad-placeholder>

                <!-- Pro Membership Card -->
                <div class="bg-[#1b1f27] rounded-xl overflow-hidden border border-[#282e39] flex flex-col">
                    <div class="h-32 bg-gradient-to-br from-primary/20 to-purple-600/20 relative">
                        <div class="absolute inset-0 bg-gradient-to-t from-[#1b1f27] to-transparent"></div>
                        <span
                            class="absolute top-3 right-3 bg-black/50 backdrop-blur-sm px-2 py-1 rounded text-[10px] font-bold text-white border border-white/10">AD</span>
                    </div>
                    <div class="p-5 flex flex-col gap-3">
                        <div>
                            <h4 class="text-white font-bold text-lg">Pro Gamer Membership</h4>
                            <p class="text-[#9ca6ba] text-sm mt-1">Get faster download speeds, exclusive skins, and zero
                                wait times.</p>
                        </div>
                        <button
                            class="mt-2 w-full py-2.5 rounded-lg bg-[#282e39] hover:bg-[#3b4354] text-white text-sm font-bold transition-colors border border-white/5">
                            Start Free Trial
                        </button>
                    </div>
                </div>

                <app-ad-placeholder size="rect" label="Advertisement Space"></app-ad-placeholder>
            </div>
        </div>
        } @else {
        <div class="flex flex-col items-center justify-center h-64 gap-4">
            <span class="material-symbols-outlined text-red-500 text-5xl">error</span>
            <p class="text-white text-lg">Invalid download session</p>
            <a routerLink="/" class="text-primary hover:underline">Return to Home</a>
        </div>
        }
    </main>

    <!-- Footer -->
    <footer class="border-t border-[#282e39] bg-[#111318] py-6 mt-8">
        <div
            class="max-w-[1280px] mx-auto px-4 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-4 text-[#5f6a80] text-sm">
            <p>Â© 2024 gg4play. All rights reserved.</p>
            <div class="flex gap-6">
                <a class="hover:text-white transition-colors" href="#">Privacy Policy</a>
                <a class="hover:text-white transition-colors" href="#">Terms of Service</a>
                <a class="hover:text-white transition-colors" href="#">Report a Problem</a>
            </div>
        </div>
    </footer>
</div>